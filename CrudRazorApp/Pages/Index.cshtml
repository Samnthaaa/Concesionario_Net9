@page
@model CrudRazorApp.Pages.IndexModel
@{
    ViewData["Title"] = "Panel de Control";
}

<svg width="0" height="0" style="display:none;">
    <symbol id="icon-car" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 16.5V15a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v1.5M10 13h4M19 12H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2zM6 12V8c0-2.2 1.8-4 4-4h4a4 4 0 0 1 4 4v4"></path></symbol>
    <symbol id="icon-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></symbol>
    <symbol id="icon-list" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></symbol>
</svg>

<h1 class="page-title">Panel de Control</h1>
<p class="page-subtitle">Análisis de la actividad y rendimiento de la flota.</p>

<div class="stats">
    <div class="stat">
        <div class="stat-header">
            <div class="stat-icon">
                <svg width="18" height="18" fill="currentColor" style="color: var(--text-primary);"><use href="#icon-car"></use></svg>
            </div>
            <h3>Autos Disponibles</h3>
        </div>
        <div class="value">@Model.AutosCount</div>
        <a asp-page="/Autos/Index" class="stat-link">Gestionar Flota &rarr;</a>
    </div>

    <div class="stat">
        <div class="stat-header">
            <div class="stat-icon">
                <svg width="18" height="18" fill="currentColor" style="color: var(--text-primary);"><use href="#icon-user"></use></svg>
            </div>
            <h3>Conductores Activos</h3>
        </div>
        <div class="value">@Model.ConductoresCount</div>
        <a asp-page="/Conductores/Index" class="stat-link">Administrar Personal &rarr;</a>
    </div>

    <div class="stat">
        <div class="stat-header">
            <div class="stat-icon">
                <svg width="18" height="18" fill="currentColor" style="color: var(--text-primary);"><use href="#icon-list"></use></svg>
            </div>
            <h3>Reservas Totales</h3>
        </div>
        <div class="value">@Model.ReservasCount</div>
        <a asp-page="/Reservas/Index" class="stat-link">Historial de Reservas &rarr;</a>
    </div>
</div>

<div class="card">
    <h3>Actividad Reciente</h3>

    @if (Model.RecentReservas.Any())
    {
        <div style="padding: 0;">
            <table class="content-table">
                <thead>
                    <tr>
                        <th>Auto</th>
                        <th>Conductor</th>
                        <th>Fecha Inicio</th>
                        <th>Fecha Fin</th>
                        <th style="text-align: right;">Estado</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var reserva in Model.RecentReservas)
                    {
                        var estado = DateTime.Now < reserva.FechaInicio ? "Pendiente" :
                        DateTime.Now > reserva.FechaFin ? "Finalizada" : "En Curso";
                        var estadoClass = estado == "Pendiente" ? "status-pending" :
                        estado == "Finalizada" ? "status-completed" : "status-active";

                        <tr>
                            <td>
                                <strong>@reserva.Auto?.Marca @reserva.Auto?.Modelo</strong><br />
                                <small style="color: var(--text-secondary);">@reserva.Auto?.Placa</small>
                            </td>
                            <td>@reserva.Conductor?.Nombre @reserva.Conductor?.Apellido</td>
                            <td>@reserva.FechaInicio.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>@reserva.FechaFin.ToString("dd/MM/yyyy HH:mm")</td>
                            <td style="text-align: right;">
                                <span class="status-badge @estadoClass">@estado</span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="empty">
            <p>No hay reservas registradas aún.</p>
            <p style="margin-top: 0.5rem; font-size: 0.9rem;">Comienza registrando tu primera reserva.</p>
        </div>
    }

    <div class="actions">
        <a asp-page="/Reservas/Create" class="btn-primary">+ Registrar Nueva Reserva</a>
    </div>
</div>

<style>
    /* Estilos para los badges de estado */
    .status-badge {
        display: inline-block;
        padding: 0.35rem 0.85rem;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        letter-spacing: 0.3px;
    }

    .status-pending {
        background-color: #FFF4E6;
        color: #E67700;
    }

    .status-active {
        background-color: #E8F5E9;
        color: #2E7D32;
    }

    .status-completed {
        background-color: #F5F5F5;
        color: #757575;
    }

    /* Ajuste para la tabla dentro de la card */
    .card > div[style*="padding: 0"] {
        margin: 0 -2rem;
        margin-top: 1rem;
    }

    .card > div[style*="padding: 0"] .content-table thead th:first-child {
        padding-left: 2rem;
    }

    .card > div[style*="padding: 0"] .content-table tbody td:first-child {
        padding-left: 2rem;
    }

    .card > div[style*="padding: 0"] .content-table thead th:last-child {
        padding-right: 2rem;
    }

    .card > div[style*="padding: 0"] .content-table tbody td:last-child {
        padding-right: 2rem;
    }
</style>