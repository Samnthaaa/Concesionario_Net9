@page
@model CrudRazorApp.Pages.IndexModel
@{
    ViewData["Title"] = "Panel de Control";
}

<svg width="0" height="0" style="display:none;">
    <symbol id="icon-car" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 16.5V15a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v1.5M10 13h4M19 12H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2zM6 12V8c0-2.2 1.8-4 4-4h4a4 4 0 0 1 4 4v4"></path></symbol>
    <symbol id="icon-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></symbol>
    <symbol id="icon-list" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></symbol>
</svg>

<!-- Hero: imagen de fondo horizontal que se desvanece al hacer scroll -->
<div id="hero" class="hero" style="background-image: url('/images/hero.jpg');">
    <div class="hero-content">
        <h1>Bienvenido</h1>
        <p>Gestión de reservas rápida y sencilla</p>
    </div>
</div>

<h1 class="page-title">Panel de Control</h1>
<p class="page-subtitle">Análisis de la actividad y rendimiento de la flota.</p>

<div class="stats">
    <div class="stat">
        <div class="stat-header">
            <div class="stat-icon">
                <svg width="18" height="18" fill="currentColor" style="color: var(--text-primary);"><use href="#icon-car"></use></svg>
            </div>
            <h3>Autos Disponibles</h3>
        </div>
        <div class="value">@Model.AutosCount</div>
        <a asp-page="/Autos/Index" class="stat-link">Gestionar Flota &rarr;</a>
    </div>

    <div class="stat">
        <div class="stat-header">
            <div class="stat-icon">
                <svg width="18" height="18" fill="currentColor" style="color: var(--text-primary);"><use href="#icon-user"></use></svg>
            </div>
            <h3>Conductores Activos</h3>
        </div>
        <div class="value">@Model.ConductoresCount</div>
        <a asp-page="/Conductores/Index" class="stat-link">Administrar Personal &rarr;</a>
    </div>

    <div class="stat">
        <div class="stat-header">
            <div class="stat-icon">
                <svg width="18" height="18" fill="currentColor" style="color: var(--text-primary);"><use href="#icon-list"></use></svg>
            </div>
            <h3>Reservas Totales</h3>
        </div>
        <div class="value">@Model.ReservasCount</div>
        <a asp-page="/Reservas/Index" class="stat-link">Historial de Reservas &rarr;</a>
    </div>
</div>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h3 style="margin: 0;">Actividad Reciente</h3>

        @if (Model.RecentReservas.Any())
        {
            <div class="search-box" style="max-width: 350px; margin: 0;">
                <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="searchReservas" placeholder="Buscar en reservas..." class="search-input" style="padding: 0.65rem 1rem 0.65rem 2.5rem; font-size: 0.9rem;" />
            </div>
        }
    </div>

    @if (Model.RecentReservas.Any())
    {
        <div style="padding: 0;">
            <table class="content-table" id="reservasTable">
                <thead>
                    <tr>
                        <th>Auto</th>
                        <th>Conductor</th>
                        <th>Fecha Inicio</th>
                        <th>Fecha Fin</th>
                        <th style="text-align: right;">Estado</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var reserva in Model.RecentReservas)
                    {
                        var estado = DateTime.Now < reserva.FechaInicio ? "Pendiente" :
                        DateTime.Now > reserva.FechaFin ? "Finalizada" : "En Curso";
                        var estadoClass = estado == "Pendiente" ? "status-pending" :
                        estado == "Finalizada" ? "status-completed" : "status-active";

                        <tr>
                            <td>
                                <strong>@reserva.Auto?.Marca @reserva.Auto?.Modelo</strong><br />
                                <small style="color: var(--text-secondary);">@reserva.Auto?.Placa</small>
                            </td>
                            <td>@reserva.Conductor?.Nombre @reserva.Conductor?.Apellido</td>
                            <td>@reserva.FechaInicio.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>@reserva.FechaFin.ToString("dd/MM/yyyy HH:mm")</td>
                            <td style="text-align: right;">
                                <span class="status-badge @estadoClass">@estado</span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div id="noResultsReservas" class="empty" style="display: none; margin-top: 0;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            <p>No se encontraron reservas</p>
            <p style="margin-top: 0.5rem; font-size: 0.9rem;">Intenta con otros términos de búsqueda</p>
        </div>
    }
    else
    {
        <div class="empty">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M8 2v4M16 2v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"></path>
            </svg>
            <p>No hay reservas registradas aún.</p>
            <p style="margin-top: 0.5rem; font-size: 0.9rem;">Comienza registrando tu primera reserva.</p>
        </div>
    }

    <div class="actions" style="margin-top: 2rem;">
        <a asp-page="/Reservas/Create" class="btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Registrar Nueva Reserva
        </a>
    </div>
</div>

<style>
    /* Estilos para los badges de estado */
    .status-badge {
        display: inline-block;
        padding: 0.35rem 0.85rem;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        letter-spacing: 0.3px;
    }

    .status-pending {
        background-color: #FFF4E6;
        color: #E67700;
    }

    .status-active {
        background-color: #E8F5E9;
        color: #2E7D32;
    }

    .status-completed {
        background-color: #F5F5F5;
        color: #757575;
    }

    /* Ajuste para la tabla dentro de la card */
    .card > div[style*="padding: 0"] {
        margin: 0 -2rem;
        margin-top: 1rem;
    }

        .card > div[style*="padding: 0"] .content-table thead th:first-child {
            padding-left: 2rem;
        }

        .card > div[style*="padding: 0"] .content-table tbody td:first-child {
            padding-left: 2rem;
        }

        .card > div[style*="padding: 0"] .content-table thead th:last-child {
            padding-right: 2rem;
        }

        .card > div[style*="padding: 0"] .content-table tbody td:last-child {
            padding-right: 2rem;
        }

    /* Estilos para el hero */
    .hero {
        position: relative;
        height: 60vh;
        max-height: 500px;
        background-position: center;
        background-size: cover;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        text-align: center;
        padding: 0 1rem;
        overflow: hidden;
    }

    .hero-content {
        position: relative;
        z-index: 2;
    }

    .hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1;
    }
</style>

<script>
    // Buscador para la tabla de reservas recientes
    const searchInput = document.getElementById('searchReservas');
    if (searchInput) {
        searchInput.addEventListener('keyup', function() {
            const searchValue = this.value.toLowerCase();
            const table = document.getElementById('reservasTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            const noResults = document.getElementById('noResultsReservas');
            let visibleCount = 0;

            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchValue)) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            }

            if (visibleCount === 0) {
                table.parentElement.style.display = 'none';
                noResults.style.display = 'flex';
            } else {
                table.parentElement.style.display = 'block';
                noResults.style.display = 'none';
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        const hero = document.getElementById('hero');
        if (!hero) return;
        let maxScroll = hero.offsetHeight || window.innerHeight * 0.45;

        function updateHero() {
            const sc = Math.min(window.scrollY, maxScroll);
            const opacity = Math.max(0, 1 - sc / maxScroll);
            hero.style.opacity = opacity;
            // ligero parallax para sensación de profundidad
            hero.style.transform = `translateY(${sc * 0.12}px)`;
        }

        window.addEventListener('scroll', updateHero, { passive: true });
        window.addEventListener('resize', function () {
            maxScroll = hero.offsetHeight || window.innerHeight * 0.45;
            updateHero();
        });

        updateHero();
    });
</script>